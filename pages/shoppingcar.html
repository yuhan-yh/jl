<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Document</title><link rel="stylesheet" href="../sass/shoppingcar.css"></head><body><div class="header"><div class="g_hd"><div class="g_hd_contain"><a href="" class="g_logo"></a><div class="g_hd_main"><div class="g_hd_main_top"><span class="loginReg"><a href="">登录</a> <span class="line">|</span> <a href="">注册</a> </span><span class="cart"><a href="" class="cart_a"><b class=""></b>购物车</a></span></div><div class="g_hd_main_bottom"><ul><li><a href=""></a></li><li class="g_hd_main_bottom_shouji"><a href=""></a></li><li><a href=""></a></li><li><a href="" style="color: #ef4222;"></a></li><li><a href=""></a></li><li><a href=""></a></li></ul><div class="search"><input type="text" class="search_l" placeholder="输入搜索内容"> <input type="submit" class="search_r" value=""></div></div></div></div></div></div><div class="sl_wrapper"><div class="sl_area"><div class="cart_process"><h1 class="title">购物车 <i class="icart"></i></h1><!-- <div class="cart_steps cart_steps1">
                    <ul>
                        <li class="step1">查看购物车</li>
                        <li class="step2">确认订单信息</li>
                        <li class="step3">确认/支付订单</li>
                    </ul>
                    <div class="icon"></div>
                </div> --></div><div class="car"><table cellspacing="0" cellpadding="0"><thead><tr><td><input type="checkbox" class="allcheck"> 全选</td><td>商品</td><td>价格</td><td>数量</td><td>小计</td><td>操作</td></tr></thead><!-- <tr>
                        <td>
                            <input type="checkbox" class="check">
                        </td>
                        <td>
                            <img src="https://imggn.gionee.com/images/201610/thumb_img/1199_thumb_P_1477362339411.jpg" alt="">
                        </td>
                        <td class="dj">50</td>
                        <td>
                            <input type="button" class="reduceBtn" value="-">
                            <input type="text" value="1" class="inputnum">
                            <input type="button" class="addBtn" value="+">
                        </td>
                        <td class="xj">50</td>
                        <td>
                            <input type="button" class="delBtn" value="删除">
                        </td>
                    </tr> --></table><div class="jiesuan"><span>总数：</span><span class="allnum">0</span><span style="margin-right:10px">件</span> <span>总计：</span><span style="color: #ef4222;">￥</span><span class="allprice">0</span> <button class="js">结算</button></div></div><div class="mycart_empty" style="display: none;"><p class="hint">您的购物车是空的，去挑选喜欢的商品吧！</p><div class="op"><a href="../index.html" class="btn">去购物</a></div></div><div class="user_recent_review"><div class="hd"><h4>猜你喜欢</h4></div><ul class="recentgoods"><li><a href="" class="img"><img src="https://imggn.gionee.com/images/201610/thumb_img/1035_thumb_P_1476243817573.jpg" alt=""></a><p class="rvgoodsname"><a href="">TC-G300快速充电器 白色</a></p><p class="price"><em>￥</em> 69.00</p></li><li><a href="" class="img"><img src="https://imggn.gionee.com/images/201610/thumb_img/1035_thumb_P_1476243817573.jpg" alt=""></a><p class="rvgoodsname"><a href="">TC-G300快速充电器 白色</a></p><p class="price"><em>￥</em> 69.00</p></li><li><a href="" class="img"><img src="https://imggn.gionee.com/images/201610/thumb_img/1035_thumb_P_1476243817573.jpg" alt=""></a><p class="rvgoodsname"><a href="">TC-G300快速充电器 白色</a></p><p class="price"><em>￥</em> 69.00</p></li><li><a href="" class="img"><img src="https://imggn.gionee.com/images/201610/thumb_img/1035_thumb_P_1476243817573.jpg" alt=""></a><p class="rvgoodsname"><a href="">TC-G300快速充电器 白色</a></p><p class="price"><em>￥</em> 69.00</p></li></ul></div></div></div><div class="footer"><div class="footer1"><ul class="wrapper"><li><a href=""><i class="c_dropgos"></i> <em>7天<br>退货保障</em></a></li><li><a href=""><i class="c_change"></i> <em>30天<br>换货承诺</em></a></li><li><a href=""><i class="c_freesheep"></i> <em>99元起<br>全场免运费</em></a></li><li><a href=""><i class="c_svspoint"></i> <em>579家<br>售后服务点</em></a></li></ul></div><div class="footer2"><dl><dt>关于金立</dt><dd><a href="">企业荣誉</a></dd><dd><a href="">金立体验店</a></dd><dd><a href="">代理商专区</a></dd><dd><a href="">加入金立</a></dd><dd><a href="">联系我们</a></dd><dd><a href="">供应/服务商需求资讯</a></dd></dl><dl><dt>新闻资讯</dt><dd><a href="">公司新闻</a></dd><dd><a href="">媒体报道</a></dd></dl><dl><dt>购物指南</dt><dd><a href="">购物流程</a></dd><dd><a href="">支付方式</a></dd><dd><a href="">配送说明及费用</a></dd><dd><a href="">订单管理</a></dd><dd><a href="">购买常见问题</a></dd><dd><a href="">预置应用公示</a></dd></dl><dl><dt>售后服务</dt><dd><a href="">售后政策</a></dd><dd><a href="">售后服务点</a></dd><dd><a href="">上门维修</a></dd><dd><a href="">签收须知</a></dd><dd><a href="">物流查询</a></dd></dl><dl><dt>关于我们</dt><dd><a href="" class="sina">新浪微博<b></b></a></dd><dd><a href="" class="tencent">腾讯微博<b></b></a></dd><dd><a href="" class="qzone">QQ空间<b></b></a></dd></dl><div class="g_gn_wx fr"><i class="ico_gn_weixin"></i> <span>扫一扫关注微信</span></div></div><div class="footer3"><div class="wrapper"><div class="c"><p>增值电信业务经营许可证： <a href="">粤B2-20120350</a> <a href="">粤ICP备05087105号</a> <a href="">粤网文[2018]10835-3804号</a> <a href="">粤文市审[2012]196号</a> <span><a href=""><img src="http://icon.szfw.org/sf.png" alt=""></a><a href=""><img style="height: 45px;width: 33px;" src="https://szcert.ebs.org.cn/Images/govIcon.gif" alt=""></a><a href=""><img src="https://shop.gionee.com/static/web201310/b.png" alt=""></a></span></p><p>Copyright © 2013 深圳市金立通信设备有限公司 版权所有 .</p></div></div></div></div></body><div class="ui_service"><div class="ui_service_item"><a href="" class="ui_service_lbl online">在线服务 <span></span></a></div><div class="ui_service_item"><a href="" class="ui_service_lbl help">帮助中心 <span></span></a></div><div class="ui_service_item"><a href="" class="ui_service_lbl backTop">在线服务 <span></span></a></div><div class="ui_service_item" style="height: 80px;text-align:center;"><img src="https://shop.gionee.com/static/web201310/code.png" style="width: 50px;height: 50px;text-align: center;margin-top: 6px;" alt=""><p class="shop-gioneewechat" style="margin-top:-2px;font-size: 12px;">金立关怀</p></div></div><script src="../public/jquery.js"></script><script>var usename=sessionStorage.getItem("usename");
    // console.log(usename);
    
    // $(".xj").html(parseInt($(this).prev().first().next().val())*parseInt($(this).prev().prev().html()));
    class car{
        constructor(){
            this.display();
            
            
           
        }
        change(){
            var that=this;
            $(".inputnum").on("input",function(){
                var reg = new RegExp(/^[0-9]*$/);
                if(!reg.test($(".inputnum").val())){
                    //删除最后一个
                    var str =$(".inputnum").val();
                    $(".inputnum").val(str.substring(0,str.length-1));
                }
                that.allPrice();
                that.allCheck();
            });
           
        }
        add(){
            var that=this;
            $(".addBtn").click(function(){
                //判断原数值
                if(parseInt($(this).prev().val())==0 || parseInt($(this).prev().val())>0){
                    $(this).prev().val( parseInt($(this).prev().val())+1);
                }else{
                    $(this).prev().val("0");
                }
                $(this).parent().next().html(parseInt($(this).prev().val())*parseInt($(this).parent().prev().html()));
                that.allPrice();
                that.allCheck();
            });
           
        }
        reduce(){
            var that=this;
            $(".reduceBtn").click(function(){
                //判断原数值
                if( parseInt($(this).next().val())>0){
                    $(this).next().val( parseInt($(this).next().val())-1);
                }else{
                    $(this).next().val("0")
                }
                $(this).parent().next().html(parseInt($(this).next().val())*parseInt($(this).parent().prev().html()));
                that.allPrice();
                that.allCheck();
            });
            
        }
        del(){
            var that = this;
            $(".delBtn").click(function(){
               $(this).parent().parent().remove();
               that.allPrice();
               that.allCheck();
            });
        }
        allPrice(){
            var str = 0;
            for(var i=0;i<$(".car").find(".check").length;i++){
                if($(".car").find(".check").eq(i).prop("checked")){
                    str+=parseInt($(".car").find(".check").eq(i).parent().next().next().next().next().html());
                    $(".allprice").html(str.toString());
                }
            }
            
        }
        check(){
            var that =this;
            for(var i=0;i<$(".car").find(".check").length;i++){
                $(".car").find(".check").eq(i).click(function(){
                that.allCheck();
                that.allPrice();
            });
            }
            
            $(".allcheck").click(function(){
                if($(".allcheck").prop("checked")){
                    $(".car").find(".check").prop("checked",true);
                    var str = 0;
                    for(var i=0;i<$(".car").find(".check").length;i++){
                        if($(".car").find(".check").eq(i).prop("checked")){
                            str+=parseInt($(".car").find(".check").eq(i).parent().next().next().next().next().html());
                            $(".allprice").html(str.toString());
                        }
                    }
                }else{
                    $(".car").find(".check").prop("checked",false);
                    $(".allprice").html("0");
                }
                
                
            });
           
            
        }
        allCheck(){
            for(var i=0;i<$(".car").find(".check").length;i++){
                if($(".car").find(".check").eq(i).prop("checked")==false){
                    return $(".allcheck").prop("checked",false);
                }else{
                    $(".allcheck").prop("checked",true);
                }
            }
        }
        display(){
            var that = this;
            $.ajax({
                    type:"POST",
                    url:"../php/selgoods.php",
                    data:{
                        m1:usename
                    },
                    dataType:"json",
                    success:function(data){
                        var data=data;
                        // console.log(data.sucMsg[0].goodsid);
                        var str="";
                        var num=0;
                        $.ajax({
                                url:"../php/xiangqing.php",
                                type:"GET",
                                dataType:"json",
                                success:function(data2){
                                    var data2=data2;
                                    // console.log(data2);
                                    for(var i=0;i<data.sucMsg.length;i++){
                                        for(var j=0;j<data2.length;j++){
                                            if(data2[j].goodsId==data.sucMsg[i].goodsid){
                                                str+=`<tr>
                                                        <td>
                                                            <input type="checkbox" class="check">
                                                        </td>
                                                        <td>
                                                            <img src="${data2[j].img.smallImg[0]}" alt="">
                                                        </td>
                                                        <td class="dj">${data2[j].price}</td>
                                                        <td>
                                                            <input type="button" class="reduceBtn" value="-">
                                                            <input type="text" value="${data.sucMsg[i].num}" class="inputnum">
                                                            <input type="button" class="addBtn" value="+">
                                                        </td>
                                                        <td class="xj">${data2[j].price*data.sucMsg[i].num}</td>
                                                        <td>
                                                            <input type="button" class="delBtn" value="删除">
                                                        </td>
                                                    </tr>`
                                                }
                                                
                                            }
                                        }
                                        $(".car thead").after(str);
                                        that.change()
                                        that.add();
                                        that.reduce();
                                        that.del();
                                        that.allPrice();
                                        that.allCheck();
                                        that.check();
                                        $(".allcheck").trigger("click");
                                }
                            });
                        
                    }

                });
        }
    }
    new car();</script></html>